(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{51:function(e,t,n){},52:function(e,t,n){},53:function(e,t,n){},81:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n.n(c),r=n(31),s=n.n(r),i=(n(51),n(52),n(53),n(1));function o(){return Object(i.jsxs)("div",{className:"login",children:[Object(i.jsx)("p",{children:"An insight into your listening habits on Spotify"}),Object(i.jsx)("a",{href:"https://react-express-spotify.herokuapp.com/login",children:" Login to Spotify "})]})}var l=n(12),j=n(3),u=n(5);function b(e){var t=Math.floor(e/6e4),n=(e%6e4/1e3).toFixed(0);return t+":"+(n<10?"0":"")+n}var d=function(){window.localStorage.clear(),window.sessionStorage.clear(),window.location.replace("/");var e=Object(c.useState)(!1),t=Object(u.a)(e,2),n=t[0],a=t[1];return n?Object(i.jsx)(Redirect,{to:"/",push:!0}):Object(i.jsx)(Button,{onClick:function(){localStorage.removeItem("whpf_user"),a(!0)},children:"LogOut"})},h=function(){return Object(i.jsxs)("div",{className:"navbar",children:[Object(i.jsx)("li",{children:Object(i.jsx)(l.b,{to:"/",children:"HOME"})}),Object(i.jsx)("li",{children:Object(i.jsx)(l.b,{to:"/TopTracks",activeStyle:{fontWeight:"bold",color:"green"},children:"Top Tracks"})}),Object(i.jsx)("li",{children:Object(i.jsx)(l.b,{to:"/RecentTracks",activeStyle:{fontWeight:"bold",color:"green"},children:"RecentlyPlayed"})}),Object(i.jsx)("li",{children:Object(i.jsx)(l.b,{to:"/Recommendations",activeStyle:{fontWeight:"bold",color:"green"},children:"Recommendations"})}),Object(i.jsx)("li",{style:{float:"right"},children:Object(i.jsx)(l.b,{to:"/logout",children:"Logout"})})]})},f=n(2),O=n.n(f),x=n(6),m=n(34),p=n.n(m),g=n(35),v=new(n.n(g).a),k=function(){var e=Object(x.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=window.localStorage.getItem("refresh_token"),p.a.get("http://localhost:8888/refresh_token",{params:{refresh_token:t}}).then((function(e){var t=e.data.access_token;console.log("New acccess_token",t),window.localStorage.setItem("access_token",t),window.localStorage.setItem("token_timestamp",Date.now()),window.location.reload()})).catch((function(e){return console.log(e)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),w=function(){var e=function(){var e,t={},n=/([^&;=]+)=?([^&;]*)/g,c=window.location.hash.substring(1);for(e=n.exec(c);e;)t[e[1]]=decodeURIComponent(e[2]),e=n.exec(c);return t}(),t=e.error,n=e.access_token,c=e.refresh_token;if(t&&(console.log(t),k()),n&&c)return window.location.replace("/"),window.localStorage.setItem("access_token",n),window.localStorage.setItem("refresh_token",c),window.localStorage.setItem("token_timestamp",Date.now()),n;var a=window.localStorage.getItem("token_timestamp");return a&&"undefined"!==a&&Date.now()-a>36e5&&(console.log("Token expired, refreshing token"),k()),window.localStorage.getItem("access_token")},y=w();v.setAccessToken(y);var S=function(e){var t=e.track;return Object(i.jsx)("a",{className:"TrackInfoLink",href:t.uri,children:Object(i.jsxs)("div",{className:"card",children:[Object(i.jsx)("img",{src:t.album.images[1].url,alt:"Track"}),Object(i.jsxs)("div",{className:"containerCard",children:[Object(i.jsx)("h4",{children:Object(i.jsx)("b",{children:t.artists.map((function(e){return e.name})).join(", ")})}),Object(i.jsx)("p",{children:t.name})]})]})})},N=function(){var e=Object(c.useState)(1),t=Object(u.a)(e,2),n=t[0],a=t[1],r=Object(c.useState)(),s=Object(u.a)(r,2),o=s[0],l=s[1],j=Object(c.useState)("short_term"),b=Object(u.a)(j,2),d=b[0],h=b[1],f=function(e,t){var n;n=t,l(),h(n),a(e)};return Object(c.useEffect)((function(){v.getMyTopTracks({limit:50,time_range:d}).then((function(e){e&&(console.log(e),l({items:e.items}))})).catch((function(){w()}))}),[d]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h2",{children:"Top Tracks"}),Object(i.jsxs)("div",{className:"container",children:[Object(i.jsxs)("div",{className:"bloc-tabs",children:[Object(i.jsx)("button",{className:1===n?"tabs active-tabs":"tabs",onClick:function(){return f(1,"short_term")},children:"4 weeks"}),Object(i.jsx)("button",{className:2===n?"tabs active-tabs":"tabs",onClick:function(){return f(2,"medium_term")},children:"6 months"}),Object(i.jsx)("button",{className:3===n?"tabs active-tabs":"tabs",onClick:function(){return f(3,"long_term")},children:"All time"})]}),o?Object(i.jsxs)("div",{className:"content-tabs",children:[Object(i.jsx)("div",{className:1===n?"content  active-content":"content",children:o.items.map((function(e,t){return Object(i.jsx)(S,{track:e},t)}))}),Object(i.jsx)("div",{className:2===n?"content  active-content":"content",children:o.items.map((function(e,t){return Object(i.jsx)(S,{track:e},t)}))}),Object(i.jsx)("div",{className:3===n?"content  active-content":"content",children:o.items.map((function(e,t){return Object(i.jsx)(S,{track:e},t)}))})]}):Object(i.jsx)("b",{children:"LOADING"})]})]})},_=n(17),T=n(4),I=n(36);var F=function(){var e=Object(x.a)(O.a.mark((function e(t,n,c){var a,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=c+n,e.next=3,v.getUserPlaylists({limit:n,offset:c}).then((function(e){e&&(r=[].concat(Object(T.a)(t),Object(T.a)(e.items)),e.next&&(r=F(r,n,a)))})).catch((function(){w()}));case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t,n,c){return e.apply(this,arguments)}}(),D=function(){var e=Object(x.a)(O.a.mark((function e(t,n,c,a){var r,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a+c,e.next=3,v.getPlaylistTracks(y,t,{limit:c,offset:a}).then((function(e){e&&(s=[].concat(Object(T.a)(n),Object(T.a)(e.items)),e.next&&(s=D(t,s,c,r)))}));case 3:return e.abrupt("return",s);case 4:case"end":return e.stop()}}),e)})));return function(t,n,c,a){return e.apply(this,arguments)}}();function R(e,t){var n=e,c=[];if(e)for(;n.length;)c=[].concat(Object(T.a)(c),[n.splice(0,t)]);return c}var A=function(){var e=Object(c.useState)(),t=Object(u.a)(e,2),n=t[0],a=t[1],r=Object(c.useState)(),s=Object(u.a)(r,2),o=s[0],l=s[1],j=Object(c.useState)(1),b=Object(u.a)(j,2),d=b[0],h=b[1],f=Object(c.useState)("sad"),m=Object(u.a)(f,2),p=m[0],g=m[1],k=Object(c.useState)(),w=Object(u.a)(k,2),y=w[0],N=w[1],A=Object(c.useState)(),C=Object(u.a)(A,2),L=C[0],E=C[1],M=JSON.parse(window.sessionStorage.getItem("audio_features")),J=JSON.parse(window.sessionStorage.getItem("tracks")),P=function(e,t){console.log(n),E(),g(t),h(e)};return Object(c.useEffect)((function(){J?(console.log("Fetching all songs..."),l(J)):function(){var e=Object(x.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,F([],50,0).then(function(){var e=Object(x.a)(O.a.mark((function e(n){var c,a,r,s,i,o;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Fetching all songs..."),c=!1,a=!1,e.prev=3,s=Object(I.a)(n.map((function(e){return e.id})));case 5:return e.next=7,s.next();case 7:if(!(c=!(i=e.sent).done)){e.next=20;break}return o=i.value,e.t0=[],e.t1=Object(T.a)(t),e.t2=T.a,e.next=14,D(o,[],100,0).then((function(e){if(e)return e.map((function(e){return e.track.id}))}));case 14:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),t=e.t0.concat.call(e.t0,e.t1,e.t4);case 17:c=!1,e.next=5;break;case 20:e.next=26;break;case 22:e.prev=22,e.t5=e.catch(3),a=!0,r=e.t5;case 26:if(e.prev=26,e.prev=27,!c||null==s.return){e.next=31;break}return e.next=31,s.return();case 31:if(e.prev=31,!a){e.next=34;break}throw r;case 34:return e.finish(31);case 35:return e.finish(26);case 36:l(t),window.sessionStorage.setItem("tracks",JSON.stringify(t));case 38:case"end":return e.stop()}}),e,null,[[3,22,26,36],[27,,31,35]])})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[]),Object(c.useEffect)((function(){if(M)console.log("Fetching audio data..."),a(M);else if(o){var e=function(){var e=Object(x.a)(O.a.mark((function e(n){var c,r,s,i;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=Object(_.a)(t),e.prev=1,c.s();case 3:if((r=c.n()).done){e.next=11;break}return s=r.value,e.next=7,v.getAudioFeaturesForTracks(s);case 7:i=e.sent,n=[].concat(Object(T.a)(n),Object(T.a)(i.audio_features));case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),c.e(e.t0);case 16:return e.prev=16,c.f(),e.finish(16);case 19:a(n),window.sessionStorage.setItem("audio_features",JSON.stringify(n));case 21:case"end":return e.stop()}}),e,null,[[1,13,16,19]])})));return function(t){return e.apply(this,arguments)}}(),t=R(o,100);console.log("Fetching audio data..."),e([])}}),[o]),Object(c.useEffect)((function(){o&&N(1)}),[o]),Object(c.useEffect)((function(){if(n)if("sad"==p){console.log(":(");var e=R(n.filter((function(e){return e.valence<.2})),50);v.getTracks(e[0].map((function(e){return e.id}))).then((function(e){E(e)}))}else if("happy"==p){console.log(":)");var t=R(n.filter((function(e){return e.energy>.7})),50);v.getTracks(t[0].map((function(e){return e.id}))).then((function(e){E(e)}))}else if("study"==p){console.log(":/");var c=R(n.filter((function(e){return e.danceability<.2})),50);v.getTracks(c[0].map((function(e){return e.id}))).then((function(e){E(e)}))}}),[p,n]),console.log(L),Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("h1",{children:" Gather all the songs from all your playlists and find which songs statistically follow these moods"}),Object(i.jsx)("div",{children:y?Object(i.jsxs)("div",{className:"container",children:[Object(i.jsxs)("h2",{children:["Songs Discovered: ",n?n.length:Object(i.jsx)(i.Fragment,{children:"0"})]}),Object(i.jsxs)("div",{className:"bloc-tabs",children:[Object(i.jsx)("button",{className:1===d?"tabs active-tabs":"tabs",onClick:function(){return P(1,"sad")},children:"Sad"}),Object(i.jsx)("button",{className:2===d?"tabs active-tabs":"tabs",onClick:function(){return P(2,"happy")},children:"Happy"}),Object(i.jsx)("button",{className:3===d?"tabs active-tabs":"tabs",onClick:function(){return P(3,"study")},children:"Study"})]})]}):Object(i.jsx)("b",{children:"Fetching all Songs...."})}),n?Object(i.jsxs)("div",{className:"content-tabs",children:[Object(i.jsx)("div",{className:1===d?"content  active-content":"content",children:L?Object(i.jsx)(i.Fragment,{children:L.tracks.map((function(e,t){return Object(i.jsx)(S,{track:e},t)}))}):Object(i.jsx)("p",{children:"Loading Sad songs :("})}),Object(i.jsx)("div",{className:2===d?"content  active-content":"content",children:L?Object(i.jsx)(i.Fragment,{children:L.tracks.map((function(e,t){return Object(i.jsx)(S,{track:e},t)}))}):Object(i.jsx)("p",{children:"Loading Happy Songs :D"})}),Object(i.jsx)("div",{className:3===d?"content  active-content":"content",children:L?Object(i.jsx)(i.Fragment,{children:L.tracks.map((function(e,t){return Object(i.jsx)(S,{track:e},t)}))}):Object(i.jsx)("p",{children:"Loading Study Songs :/"})})]}):Object(i.jsx)("b",{children:"Fetching Audio Data..."})]})},C=n(45),L=function(){var e=Object(c.useState)(),t=Object(u.a)(e,2),n=t[0],a=t[1];return Object(c.useEffect)((function(){v.getMyRecentlyPlayedTracks({limit:50}).then((function(e){e&&(console.log(e),a({items:e.items}))})).catch((function(){w()}))}),[]),console.log(n),Object(i.jsx)("div",{children:n?Object(i.jsxs)("div",{className:"recently-played",children:[Object(i.jsx)("h2",{children:"Recently played tracks"}),Object(i.jsxs)("table",{className:"table",children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("th",{children:"Duration"}),Object(i.jsx)("th",{children:"Track"}),Object(i.jsx)("th",{children:"Artist(s)"}),Object(i.jsx)("th",{children:"Played at"})]})}),Object(i.jsx)("tbody",{children:n.items.map((function(e){return function(e){return Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:Object(i.jsx)("a",{href:e.track.uri,className:"row-link",children:b(e.track.duration_ms)})}),Object(i.jsx)("td",{children:Object(i.jsx)("a",{href:e.track.uri,tabIndex:"-1",className:"row-link",children:e.track.name})}),Object(i.jsx)("td",{children:Object(i.jsx)("a",{href:e.track.uri,tabIndex:"-1",className:"row-link",children:e.track.artists.map((function(e){return e.name})).join(", ")})}),Object(i.jsx)("td",{children:Object(i.jsx)("a",{href:e.track.uri,tabIndex:"-1",className:"row-link",children:Object(C.a)(Date.parse(e.played_at),"dd/MM/yyyy, hh:mma")})})]},e.played_at)}(e)}))})]})]}):Object(i.jsx)("b",{children:"LOADING"})})};n(80);function E(){return Object(i.jsx)(l.a,{children:Object(i.jsxs)("div",{children:[Object(i.jsx)(h,{}),Object(i.jsxs)(j.c,{children:[Object(i.jsx)(j.a,{path:"/RecentTracks",children:Object(i.jsx)(L,{})}),Object(i.jsx)(j.a,{path:"/logout",children:Object(i.jsx)(d,{})}),Object(i.jsx)(j.a,{path:"/TopTracks",children:Object(i.jsx)(N,{})}),Object(i.jsx)(j.a,{path:"/Recommendations",children:Object(i.jsx)(A,{})}),Object(i.jsx)(j.a,{path:"/",children:Object(i.jsx)("h1",{children:"Welcome to Spoti-FYI"})})]})]})})}var M=function(){return Object(i.jsx)("div",{className:"App",children:y?Object(i.jsx)(E,{}):Object(i.jsx)(o,{})})};s.a.render(Object(i.jsx)(a.a.StrictMode,{children:Object(i.jsx)(M,{})}),document.getElementById("root"))}},[[81,1,2]]]);
//# sourceMappingURL=main.867a1836.chunk.js.map