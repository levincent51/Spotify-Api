(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{104:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),a=n(25),s=n.n(a),i=(n(75),n(76),n(77),n(1));function o(){return Object(i.jsxs)("div",{className:"login",children:[Object(i.jsx)("p",{children:"An insight into your listening habits on Spotify"}),Object(i.jsx)("a",{href:"https://react-express-spotify.herokuapp.com/login",children:" Login to Spotify. "})]})}var l=n(6),j=n.n(l),u=n(15),b=n(4),d=n(22),h=n(8);function O(e){var t=Math.floor(e/6e4),n=(e%6e4/1e3).toFixed(0);return t+":"+(n<10?"0":"")+n}var f=function(){window.localStorage.clear(),window.sessionStorage.clear(),window.location.replace("/");var e=Object(c.useState)(!1),t=Object(b.a)(e,2),n=t[0],r=t[1];return n?Object(i.jsx)(Redirect,{to:"/",push:!0}):Object(i.jsx)(Button,{onClick:function(){localStorage.removeItem("whpf_user"),r(!0)},children:"LogOut"})},x=function(){return Object(i.jsxs)("div",{className:"navbar",children:[Object(i.jsx)("li",{style:{background:"green"},children:Object(i.jsx)(d.b,{to:"/",activeStyle:{fontWeight:"bold",color:"white",background:"green"},children:"HOME"})}),Object(i.jsx)("li",{children:Object(i.jsx)(d.b,{to:"/Moods",activeStyle:{fontWeight:"bold",color:"green",textDecoration:"underline"},children:"Moods"})}),Object(i.jsx)("li",{children:Object(i.jsx)(d.b,{to:"/TopTracks",activeStyle:{fontWeight:"bold",color:"green",textDecoration:"underline"},children:"Top Tracks"})}),Object(i.jsx)("li",{children:Object(i.jsx)(d.b,{to:"/RecentTracks",activeStyle:{fontWeight:"bold",color:"green",textDecoration:"underline"},children:"RecentlyPlayed"})}),Object(i.jsx)("li",{style:{float:"right"},children:Object(i.jsx)(d.b,{to:"/logout",children:"Logout"})})]})},p=n(52),m=n.n(p),v=n(53),g=new(n.n(v).a),k=function(){var e=Object(u.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=window.localStorage.getItem("refresh_token"),m.a.get("https://react-express-spotify.herokuapp.com/refresh_token",{params:{refresh_token:t}}).then((function(e){var t=e.data.access_token;return console.log("New acccess_token",t),g.setAccessToken(t),window.localStorage.setItem("access_token",t),window.localStorage.setItem("token_timestamp",Date.now()),window.location.reload(),t})).catch((function(e){console.log(e),window.localStorage.clear()})).finally(window.location.reload());case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),w=function(){var e=function(){var e,t={},n=/([^&;=]+)=?([^&;]*)/g,c=window.location.hash.substring(1);for(e=n.exec(c);e;)t[e[1]]=decodeURIComponent(e[2]),e=n.exec(c);return t}(),t=e.error,n=e.access_token,c=e.refresh_token;if(t&&(console.log(t),k()),n&&c)return window.location.replace("/"),window.localStorage.setItem("access_token",n),window.localStorage.setItem("refresh_token",c),window.localStorage.setItem("token_timestamp",Date.now()),n;var r=window.localStorage.getItem("token_timestamp");return r&&"undefined"!==r&&Date.now()-r>36e5?(console.log("Token expired, refreshing token"),k()):window.localStorage.getItem("access_token")},y=w();g.setAccessToken(y);var S=n(118),N=function(){var e=Object(c.useState)(),t=Object(b.a)(e,2),n=t[0],r=t[1];return Object(c.useEffect)((function(){g.getMe().then((function(e){r(e)})).catch((function(){w()}))}),[]),console.log(n),Object(i.jsx)("div",{children:n?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("h1",{children:"Welcome to Spoti-FYI."}),Object(i.jsxs)("h2",{children:["Hi ",n.display_name.split(" ")[0]," "]}),Object(i.jsx)("img",{src:n.images[0].url})]}):Object(i.jsx)(S.a,{})})},_=function(e){var t=e.track,n=e.index;return Object(i.jsx)("a",{className:"TrackInfoLink",href:t.uri,children:Object(i.jsxs)("div",{className:"card",children:[Object(i.jsx)("div",{className:"rank",children:n+1}),Object(i.jsx)("img",{src:t.album.images[1].url,alt:"Track"}),Object(i.jsxs)("div",{className:"containerCard",children:[Object(i.jsx)("h4",{children:Object(i.jsx)("b",{children:t.artists.map((function(e){return e.name})).join(", ")})}),Object(i.jsx)("p",{children:t.name})]})]})})},I=function(){var e=Object(c.useState)(1),t=Object(b.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)(),s=Object(b.a)(a,2),o=s[0],l=s[1],j=Object(c.useState)("short_term"),u=Object(b.a)(j,2),d=u[0],h=u[1],O=function(e,t){var n;(n=t)!=d&&l(),h(n),r(e)};return Object(c.useEffect)((function(){g.getMyTopTracks({limit:50,time_range:d}).then((function(e){e&&(console.log(e),l({items:e.items}))})).catch((function(){w()}))}),[d]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h2",{children:"Top Tracks"}),Object(i.jsxs)("div",{className:"container",children:[Object(i.jsxs)("div",{className:"bloc-tabs",children:[Object(i.jsx)("button",{className:1===n?"tabs active-tabs":"tabs",onClick:function(){return O(1,"short_term")},children:"4 weeks"}),Object(i.jsx)("button",{className:2===n?"tabs active-tabs":"tabs",onClick:function(){return O(2,"medium_term")},children:"6 months"}),Object(i.jsx)("button",{className:3===n?"tabs active-tabs":"tabs",onClick:function(){return O(3,"long_term")},children:"All time"})]}),o?Object(i.jsxs)("div",{className:"content-tabs",children:[Object(i.jsx)("div",{className:1===n?"content  active-content":"content",children:o.items.map((function(e,t){return Object(i.jsx)(_,{track:e,index:o.items.indexOf(e)},t)}))}),Object(i.jsx)("div",{className:2===n?"content  active-content":"content",children:o.items.map((function(e,t){return Object(i.jsx)(_,{track:e,index:o.items.indexOf(e)},t)}))}),Object(i.jsx)("div",{className:3===n?"content  active-content":"content",children:o.items.map((function(e,t){return Object(i.jsx)(_,{track:e,index:o.items.indexOf(e)},t)}))})]}):Object(i.jsx)(S.a,{})]})]})},T=n(55),F=n(7),C=n(56),D=function(){var e=Object(u.a)(j.a.mark((function e(t,n,c){var r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c+n,e.next=3,g.getUserPlaylists({limit:n,offset:c}).then((function(e){e&&(console.log(e),a=[].concat(Object(F.a)(t),Object(F.a)(e.items)),e.next&&(a=D(a,n,r)))})).catch((function(){w()}));case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n,c){return e.apply(this,arguments)}}(),E=function(){var e=Object(u.a)(j.a.mark((function e(t,n,c,r){var a,s;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r+c,e.next=3,g.getPlaylistTracks(y,t,{limit:c,offset:r}).then((function(e){e&&(s=[].concat(Object(F.a)(n),Object(F.a)(e.items)),e.next&&(s=E(t,s,c,a)))}));case 3:return e.abrupt("return",s);case 4:case"end":return e.stop()}}),e)})));return function(t,n,c,r){return e.apply(this,arguments)}}(),M=function(){var e=Object(u.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(t,[],100,0).then((function(e){if(e)return e.filter((function(e){return e.track})).map((function(e){return e.track.id}))}));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function A(e,t){var n=e,c=[];if(e)for(;n.length;)c=[].concat(Object(F.a)(c),[n.splice(0,t)]);return c}var P=n(120),L=n(122),R=n(121),G=function(){var e=Object(c.useState)(),t=Object(b.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)(),s=Object(b.a)(a,2),o=s[0],l=s[1],d=Object(c.useState)(!1),h=Object(b.a)(d,2),O=h[0],f=h[1],x=Object(c.useRef)(0),p=Object(c.useState)(),m=Object(b.a)(p,2),v=m[0],k=m[1],w=Object(c.useState)(),y=Object(b.a)(w,2),N=y[0],I=y[1],E=JSON.parse(window.sessionStorage.getItem("audio_features")),G=JSON.parse(window.sessionStorage.getItem("tracks")),J=function(){var e=Object(u.a)(j.a.mark((function e(t){var n,c,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={tracks:[]},c=0;case 2:if(!(c<t.length)){e.next=10;break}return e.next=5,g.getTracks(t[c].map((function(e){return e.id})));case 5:r=e.sent,n.tracks=[].concat(Object(F.a)(n.tracks),Object(F.a)(r.tracks));case 7:c++,e.next=2;break;case 10:I(n);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(c.useEffect)((function(){G?(console.log("Fetching all songs..."),l(G),x.current=G.length):function(){var e=Object(u.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,D([],50,0).then(function(){var e=Object(u.a)(j.a.mark((function e(n){var c,r,a,s,i,o,u;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Fetching all songs..."),c=!1,r=!1,e.prev=3,s=Object(C.a)(n.map((function(e){return e.id})));case 5:return e.next=7,s.next();case 7:if(!(c=!(i=e.sent).done)){e.next=20;break}return o=i.value,e.t0=[],e.t1=Object(F.a)(t),e.t2=F.a,e.next=14,M(o);case 14:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),t=e.t0.concat.call(e.t0,e.t1,e.t4);case 17:c=!1,e.next=5;break;case 20:e.next=26;break;case 22:e.prev=22,e.t5=e.catch(3),r=!0,a=e.t5;case 26:if(e.prev=26,e.prev=27,!c||null==s.return){e.next=31;break}return e.next=31,s.return();case 31:if(e.prev=31,!r){e.next=34;break}throw a;case 34:return e.finish(31);case 35:return e.finish(26);case 36:u=Object(F.a)(new Set(t)),l(u),window.sessionStorage.setItem("tracks",JSON.stringify(u)),x.current=u.length;case 40:case"end":return e.stop()}}),e,null,[[3,22,26,36],[27,,31,35]])})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[]),Object(c.useEffect)((function(){if(E)console.log("Fetching audio data..."),r(E);else if(o){var e=function(){var e=Object(u.a)(j.a.mark((function e(n){var c,a,s,i,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=Object(T.a)(t),e.prev=1,c.s();case 3:if((a=c.n()).done){e.next=11;break}return s=a.value,e.next=7,g.getAudioFeaturesForTracks(s);case 7:i=e.sent,n=[].concat(Object(F.a)(n),Object(F.a)(i.audio_features));case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),c.e(e.t0);case 16:return e.prev=16,c.f(),e.finish(16);case 19:o=n.filter((function(e){return e})),r(o),window.sessionStorage.setItem("audio_features",JSON.stringify(n));case 22:case"end":return e.stop()}}),e,null,[[1,13,16,19]])})));return function(t){return e.apply(this,arguments)}}(),t=A(o,100);console.log("Fetching audio data..."),e([])}}),[o]),Object(c.useEffect)((function(){o&&k(1)}),[o]);var W=Object(c.useState)(.5),B=Object(b.a)(W,2),H=B[0],U=B[1],V=Object(c.useState)(.5),Y=Object(b.a)(V,2),q=Y[0],z=Y[1],K=Object(c.useState)(.5),Q=Object(b.a)(K,2),X=Q[0],Z=Q[1],$=Object(c.useState)(!1),ee=Object(b.a)($,2),te=ee[0],ne=ee[1],ce=Object(c.useCallback)(Object(u.a)(j.a.mark((function e(){var t,c,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:I(),f(!0),t=n.filter((function(e){return e.valence>=H-.1&&e.valence<=H+.1&&e.energy>=q-.1&&e.energy<=q+.1&&e.danceability>=X-.1&&e.danceability<=X+.1})),c=te?t.filter((function(e){return e.instrumentalness<=.4})):t.filter((function(e){return e.instrumentalness>=.8})),r=A(c,50),console.log(r),J(r);case 7:case"end":return e.stop()}}),e)}))));return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("h1",{children:[" ","Gather all your songs and find the perfect songs to match your current mood"]}),Object(i.jsx)("h2",{children:"Choose source (in development)"}),Object(i.jsx)("button",{children:" Get All Liked Songs"}),Object(i.jsx)("button",{children:" Get All Playlists"}),Object(i.jsx)("button",{children:" Get Only Your Playlists"}),Object(i.jsx)("button",{children:" Get Everything"}),Object(i.jsx)("div",{children:v?Object(i.jsxs)("div",{className:"container",children:[Object(i.jsxs)("h2",{children:["Total Songs Discovered: ",x.current]}),Object(i.jsxs)("div",{className:"sliders",children:[Object(i.jsxs)("div",{children:[Object(i.jsx)(P.a,{children:"Mood"}),Object(i.jsx)(L.a,{value:100*H,onChange:function(e,t){U(t/100)},"aria-labelledby":"discrete-slider-small-steps",marks:[{value:0,label:"sad"},{value:50,label:"neutral"},{value:100,label:"happy"}],min:0,max:100,valueLabelDisplay:"auto"})]}),Object(i.jsxs)("div",{children:[Object(i.jsx)(P.a,{children:"Energy"}),Object(i.jsx)(L.a,{value:100*q,onChange:function(e,t){z(t/100)},"aria-labelledby":"discrete-slider-small-steps",marks:[{value:0,label:"chill"},{value:50,label:"neutral"},{value:100,label:"hype"}],min:0,max:100,valueLabelDisplay:"auto"})]}),Object(i.jsxs)("div",{children:[Object(i.jsx)(P.a,{children:"Groove"}),Object(i.jsx)(L.a,{value:100*X,onChange:function(e,t){Z(t/100)},"aria-labelledby":"discrete-slider-small-steps",marks:[{value:0,label:"calm"},{value:50,label:"neutral"},{value:100,label:"dance!"}],min:0,max:100,valueLabelDisplay:"auto"})]}),Object(i.jsxs)("div",{children:[Object(i.jsx)(P.a,{children:"Vocals"}),Object(i.jsx)(R.a,{onChange:function(){ne(!te)},label:"Vocals"})]})]})]}):Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("b",{children:"Fetching all Songs...."}),Object(i.jsx)(S.a,{}),Object(i.jsx)("p",{children:"Please do not refresh/leave the page while this is occuring."})," "]})}),n?Object(i.jsxs)("div",{children:[Object(i.jsxs)("p",{children:["Songs Found: ",N?Object(i.jsx)(i.Fragment,{children:N.tracks.length}):0," "]}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:ce,children:"Find Songs!"})}),N?N.tracks.length?N.tracks.map((function(e,t){return Object(i.jsx)(_,{track:e,index:N.tracks.indexOf(e)},t)})):Object(i.jsx)("p",{children:"no songs "}):O?Object(i.jsx)(S.a,{}):Object(i.jsx)("p",{children:"Click the button to find your songs!"})]}):Object(i.jsx)(i.Fragment,{children:v?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("b",{children:"Fetching Audio Data..."})," ",Object(i.jsx)(S.a,{})]}):null})]})},J=n(66),W=function(){var e=Object(c.useState)(),t=Object(b.a)(e,2),n=t[0],r=t[1];return Object(c.useEffect)((function(){g.getMyRecentlyPlayedTracks({limit:50}).then((function(e){e&&(console.log(e),r({items:e.items}))})).catch((function(){w()}))}),[]),console.log(n),Object(i.jsxs)("div",{children:[Object(i.jsx)("h2",{children:"Recently played tracks"}),n?Object(i.jsx)("div",{className:"recently-played",children:Object(i.jsxs)("table",{className:"table",children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("th",{children:"Duration"}),Object(i.jsx)("th",{children:"Track"}),Object(i.jsx)("th",{children:"Artist(s)"}),Object(i.jsx)("th",{children:"Played at"})]})}),Object(i.jsx)("tbody",{children:n.items.map((function(e){return function(e){return Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:Object(i.jsx)("a",{href:e.track.uri,className:"row-link",children:O(e.track.duration_ms)})}),Object(i.jsx)("td",{children:Object(i.jsx)("a",{href:e.track.uri,tabIndex:"-1",className:"row-link",children:e.track.name})}),Object(i.jsx)("td",{children:Object(i.jsx)("a",{href:e.track.uri,tabIndex:"-1",className:"row-link",children:e.track.artists.map((function(e){return e.name})).join(", ")})}),Object(i.jsx)("td",{children:Object(i.jsx)("a",{href:e.track.uri,tabIndex:"-1",className:"row-link",children:Object(J.a)(Date.parse(e.played_at),"dd/MM/yyyy, hh:mma")})})]},e.played_at)}(e)}))})]})}):Object(i.jsx)(S.a,{})]})},B=n(65);function H(){var e=Object(c.useState)(!1),t=Object(b.a)(e,2),n=t[0],r=t[1];return Object(c.useEffect)((function(){var e=setInterval(Object(u.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g.getMyCurrentPlaybackState().then((function(e){e?e.is_playing&&r(!0):e||r(!1)})).catch((function(){w()}));case 1:case"end":return e.stop()}}),e)}))),7e3);return function(){return clearInterval(e)}}),[n]),Object(i.jsx)(d.a,{children:Object(i.jsxs)("div",{children:[Object(i.jsx)(x,{}),Object(i.jsxs)(h.c,{children:[Object(i.jsx)(h.a,{path:"/RecentTracks",children:Object(i.jsx)(W,{})}),Object(i.jsx)(h.a,{path:"/logout",children:Object(i.jsx)(f,{})}),Object(i.jsx)(h.a,{path:"/TopTracks",children:Object(i.jsx)(I,{})}),Object(i.jsx)(h.a,{path:"/Moods",children:Object(i.jsx)(G,{})}),Object(i.jsx)(h.a,{path:"/",children:Object(i.jsx)(N,{})})]}),n?Object(i.jsxs)("div",{className:"player",children:[Object(i.jsx)("b",{children:"Currently Playing"}),Object(i.jsx)(B.a,{token:y,syncExternalDevice:!0,syncExternalDeviceInterval:5})]}):Object(i.jsx)("div",{className:"player",children:Object(i.jsx)("b",{children:"Currently Not Playing Anything "})})]})})}var U=function(){return Object(i.jsx)("div",{className:"App",children:y?Object(i.jsx)(H,{}):Object(i.jsx)(o,{})})};s.a.render(Object(i.jsx)(r.a.StrictMode,{children:Object(i.jsx)(U,{})}),document.getElementById("root"))},75:function(e,t,n){},76:function(e,t,n){},77:function(e,t,n){}},[[104,1,2]]]);
//# sourceMappingURL=main.a4a943ae.chunk.js.map