{"ast":null,"code":"import axios from 'axios';\nimport { getHashParams, getObject, setObject } from './functions';\nconst EXPIRATION_TIME = 3600000; // 1 hour\n\nconst SERVER = 'http://localhost:8888/'; //REFRESH ACCESS TOKEN EVERY 1 HOUR\n// REFRESH_URI\n\nconst refreshAccessToken = async () => {\n  // take refresh token from local storage\n  const refresh_token = window.localStorage.getItem('refresh_token');\n  axios.post('http://localhost:8888/refresh_token', {\n    refresh_token\n  }).then(res => {\n    const access_token = res.data.access_token;\n    console.log('New acccess_token', access_token);\n    window.localStorage.setItem('access_token', access_token);\n    window.localStorage.setItem('token_timestamp', Date.now());\n    window.location.reload();\n  }).catch(e => console.log(e));\n}; // GET TOKEN, REFRESH IF REQUIRED\n\n\nexport const getAccessToken = () => {\n  // Takes token from our url\n  refreshAccessToken();\n  const {\n    error,\n    access_token,\n    refresh_token\n  } = getHashParams();\n\n  if (error) {\n    console.log(error);\n    refreshAccessToken();\n  }\n\n  if (access_token && refresh_token) {\n    window.localStorage.setItem('access_token', access_token);\n    window.localStorage.setItem('refresh_token', refresh_token);\n    window.localStorage.setItem('token_timestamp', Date.now());\n    return access_token;\n  }\n\n  const tokenExpiry = window.localStorage.getItem('token_timestamp');\n\n  if (tokenExpiry && tokenExpiry !== 'undefined' && Date.now() - tokenExpiry > EXPIRATION_TIME) {\n    console.log('Access token expired, refreshing token...');\n    refreshAccessToken();\n  }\n\n  const local_access_token = window.localStorage.getItem('access_token');\n  return local_access_token;\n};\nexport const token = getAccessToken();","map":{"version":3,"sources":["/Users/macuser/project/spotify-node-react-starter-kit/client/src/components/spotifyAPI.js"],"names":["axios","getHashParams","getObject","setObject","EXPIRATION_TIME","SERVER","refreshAccessToken","refresh_token","window","localStorage","getItem","post","then","res","access_token","data","console","log","setItem","Date","now","location","reload","catch","e","getAccessToken","error","tokenExpiry","local_access_token","token"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,aAAT,EAAwBC,SAAxB,EAAmCC,SAAnC,QAAoD,aAApD;AAEA,MAAMC,eAAe,GAAG,OAAxB,C,CAAiC;;AACjC,MAAMC,MAAM,GAAG,wBAAf,C,CACA;AACA;;AACA,MAAMC,kBAAkB,GAAG,YAAY;AACnC;AACA,QAAMC,aAAa,GAAGC,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,eAA5B,CAAtB;AACAV,EAAAA,KAAK,CACFW,IADH,CACQ,qCADR,EAC+C;AAC3CJ,IAAAA;AAD2C,GAD/C,EAIGK,IAJH,CAISC,GAAD,IAAS;AACb,UAAMC,YAAY,GAAGD,GAAG,CAACE,IAAJ,CAASD,YAA9B;AACAE,IAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAiCH,YAAjC;AACAN,IAAAA,MAAM,CAACC,YAAP,CAAoBS,OAApB,CAA4B,cAA5B,EAA4CJ,YAA5C;AACAN,IAAAA,MAAM,CAACC,YAAP,CAAoBS,OAApB,CAA4B,iBAA5B,EAA+CC,IAAI,CAACC,GAAL,EAA/C;AACAZ,IAAAA,MAAM,CAACa,QAAP,CAAgBC,MAAhB;AACD,GAVH,EAWGC,KAXH,CAWUC,CAAD,IAAOR,OAAO,CAACC,GAAR,CAAYO,CAAZ,CAXhB;AAYH,CAfD,C,CAiBA;;;AACA,OAAO,MAAMC,cAAc,GAAG,MAAM;AAChC;AACAnB,EAAAA,kBAAkB;AAClB,QAAM;AAAEoB,IAAAA,KAAF;AAASZ,IAAAA,YAAT;AAAuBP,IAAAA;AAAvB,MAAyCN,aAAa,EAA5D;;AACA,MAAIyB,KAAJ,EAAW;AACTV,IAAAA,OAAO,CAACC,GAAR,CAAYS,KAAZ;AACApB,IAAAA,kBAAkB;AACnB;;AAED,MAAIQ,YAAY,IAAIP,aAApB,EAAmC;AACjCC,IAAAA,MAAM,CAACC,YAAP,CAAoBS,OAApB,CAA4B,cAA5B,EAA4CJ,YAA5C;AACAN,IAAAA,MAAM,CAACC,YAAP,CAAoBS,OAApB,CAA4B,eAA5B,EAA6CX,aAA7C;AACAC,IAAAA,MAAM,CAACC,YAAP,CAAoBS,OAApB,CAA4B,iBAA5B,EAA+CC,IAAI,CAACC,GAAL,EAA/C;AACA,WAAON,YAAP;AACD;;AAED,QAAMa,WAAW,GAAGnB,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,iBAA5B,CAApB;;AAEA,MACEiB,WAAW,IACXA,WAAW,KAAK,WADhB,IAEAR,IAAI,CAACC,GAAL,KAAaO,WAAb,GAA2BvB,eAH7B,EAIE;AACAY,IAAAA,OAAO,CAACC,GAAR,CAAY,2CAAZ;AACAX,IAAAA,kBAAkB;AACnB;;AAED,QAAMsB,kBAAkB,GAAGpB,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,cAA5B,CAA3B;AAEA,SAAOkB,kBAAP;AACH,CA9BM;AAgCP,OAAO,MAAMC,KAAK,GAAGJ,cAAc,EAA5B","sourcesContent":["import axios from 'axios';\nimport { getHashParams, getObject, setObject } from './functions';\n\nconst EXPIRATION_TIME = 3600000; // 1 hour\nconst SERVER = 'http://localhost:8888/'\n//REFRESH ACCESS TOKEN EVERY 1 HOUR\n// REFRESH_URI\nconst refreshAccessToken = async () => {\n    // take refresh token from local storage\n    const refresh_token = window.localStorage.getItem('refresh_token');\n    axios\n      .post('http://localhost:8888/refresh_token', {\n        refresh_token,\n      })\n      .then((res) => {\n        const access_token = res.data.access_token;\n        console.log('New acccess_token', access_token);\n        window.localStorage.setItem('access_token', access_token);\n        window.localStorage.setItem('token_timestamp', Date.now());\n        window.location.reload();\n      })\n      .catch((e) => console.log(e));\n};\n\n// GET TOKEN, REFRESH IF REQUIRED\nexport const getAccessToken = () => {\n    // Takes token from our url\n    refreshAccessToken();\n    const { error, access_token, refresh_token } = getHashParams();\n    if (error) {\n      console.log(error);\n      refreshAccessToken();\n    }\n  \n    if (access_token && refresh_token) {\n      window.localStorage.setItem('access_token', access_token);\n      window.localStorage.setItem('refresh_token', refresh_token);\n      window.localStorage.setItem('token_timestamp', Date.now());\n      return access_token;\n    }\n  \n    const tokenExpiry = window.localStorage.getItem('token_timestamp');\n\n    if (\n      tokenExpiry &&\n      tokenExpiry !== 'undefined' &&\n      Date.now() - tokenExpiry > EXPIRATION_TIME\n    ) {\n      console.log('Access token expired, refreshing token...');\n      refreshAccessToken();\n    }\n  \n    const local_access_token = window.localStorage.getItem('access_token');\n  \n    return local_access_token;\n};\n\nexport const token = getAccessToken();"]},"metadata":{},"sourceType":"module"}