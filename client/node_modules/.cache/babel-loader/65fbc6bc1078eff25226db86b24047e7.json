{"ast":null,"code":"import _regeneratorRuntime from\"/Users/macuser/project/spotify-api-project/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/macuser/project/spotify-api-project/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import axios from\"axios\";import{getHashParams,getObject,setObject}from\"./functions\";import SpotifyWebApi from\"spotify-web-api-js\";var EXPIRATION_TIME=3600000;// 1 hour\nvar SERVER=\"https://react-express-spotify.herokuapp.com/\";// or https://react-express-spotify.herokuapp.com http://localhost:8888\n//REFRESH ACCESS TOKEN EVERY 1 HOUR\n// REFRESH_URI\n// USES JMPerez's spotify-web-api-js\nexport var spotifyApi=new SpotifyWebApi();// constantly refreshing\nexport var refreshAccessToken=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var refresh_token;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// take refresh token from local storage\nrefresh_token=window.localStorage.getItem(\"refresh_token\");axios.get(SERVER+\"refresh_token\",{params:{refresh_token:refresh_token}}).then(function(res){var access_token=res.data.access_token;console.log(\"New acccess_token\",access_token);window.localStorage.setItem(\"access_token\",access_token);window.localStorage.setItem(\"token_timestamp\",Date.now());window.location.reload();}).catch(function(e){return console.log(e);});case 2:case\"end\":return _context.stop();}}},_callee);}));return function refreshAccessToken(){return _ref.apply(this,arguments);};}();// GET TOKEN, REFRESH IF REQUIRED\nexport var getAccessToken=function getAccessToken(){// Takes token from our url\nvar _getHashParams=getHashParams(),error=_getHashParams.error,access_token=_getHashParams.access_token,refresh_token=_getHashParams.refresh_token;//  token invalid freom timeout\nif(error){console.log(error);refreshAccessToken();}if(access_token&&refresh_token){window.location.replace(\"/\");window.localStorage.setItem(\"access_token\",access_token);window.localStorage.setItem(\"refresh_token\",refresh_token);window.localStorage.setItem(\"token_timestamp\",Date.now());return access_token;}// THIS WILL AUTO REFRESH OUR TOKEN BASED ON EXPIRY TIME\nvar tokenExpiry=window.localStorage.getItem(\"token_timestamp\");if(tokenExpiry&&tokenExpiry!==\"undefined\"&&Date.now()-tokenExpiry>EXPIRATION_TIME){console.log(\"Token expired, refreshing token\");refreshAccessToken();}var local_access_token=window.localStorage.getItem(\"access_token\");return local_access_token;};// SET OUR TOKEN with our spotify-web-api-js\nexport var token=getAccessToken();spotifyApi.setAccessToken(token);","map":{"version":3,"sources":["/Users/macuser/project/spotify-api-project/client/src/components/spotifyAPI.js"],"names":["axios","getHashParams","getObject","setObject","SpotifyWebApi","EXPIRATION_TIME","SERVER","spotifyApi","refreshAccessToken","refresh_token","window","localStorage","getItem","get","params","then","res","access_token","data","console","log","setItem","Date","now","location","reload","catch","e","getAccessToken","error","replace","tokenExpiry","local_access_token","token","setAccessToken"],"mappings":"qQAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,aAAT,CAAwBC,SAAxB,CAAmCC,SAAnC,KAAoD,aAApD,CACA,MAAOC,CAAAA,aAAP,KAA0B,oBAA1B,CAEA,GAAMC,CAAAA,eAAe,CAAG,OAAxB,CAAiC;AACjC,GAAMC,CAAAA,MAAM,CAAG,8CAAf,CAA+D;AAC/D;AACA;AAEA;AAEA,MAAO,IAAMC,CAAAA,UAAU,CAAG,GAAIH,CAAAA,aAAJ,EAAnB,CAEP;AACA,MAAO,IAAMI,CAAAA,kBAAkB,0FAAG,qJAChC;AACMC,aAF0B,CAEVC,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,eAA5B,CAFU,CAGhCZ,KAAK,CACFa,GADH,CACOP,MAAM,CAAG,eADhB,CACiC,CAC7BQ,MAAM,CAAE,CACNL,aAAa,CAAEA,aADT,CADqB,CADjC,EAMGM,IANH,CAMQ,SAACC,GAAD,CAAS,CACb,GAAMC,CAAAA,YAAY,CAAGD,GAAG,CAACE,IAAJ,CAASD,YAA9B,CACAE,OAAO,CAACC,GAAR,CAAY,mBAAZ,CAAiCH,YAAjC,EACAP,MAAM,CAACC,YAAP,CAAoBU,OAApB,CAA4B,cAA5B,CAA4CJ,YAA5C,EACAP,MAAM,CAACC,YAAP,CAAoBU,OAApB,CAA4B,iBAA5B,CAA+CC,IAAI,CAACC,GAAL,EAA/C,EACAb,MAAM,CAACc,QAAP,CAAgBC,MAAhB,GACD,CAZH,EAaGC,KAbH,CAaS,SAACC,CAAD,QAAOR,CAAAA,OAAO,CAACC,GAAR,CAAYO,CAAZ,CAAP,EAbT,EAHgC,sDAAH,kBAAlBnB,CAAAA,kBAAkB,0CAAxB,CAmBP;AACA,MAAO,IAAMoB,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAM,CAClC;AAEA,mBAA+C3B,aAAa,EAA5D,CAAQ4B,KAAR,gBAAQA,KAAR,CAAeZ,YAAf,gBAAeA,YAAf,CAA6BR,aAA7B,gBAA6BA,aAA7B,CAEA;AACA,GAAIoB,KAAJ,CAAW,CACTV,OAAO,CAACC,GAAR,CAAYS,KAAZ,EACArB,kBAAkB,GACnB,CAED,GAAIS,YAAY,EAAIR,aAApB,CAAmC,CACjCC,MAAM,CAACc,QAAP,CAAgBM,OAAhB,CAAwB,GAAxB,EACApB,MAAM,CAACC,YAAP,CAAoBU,OAApB,CAA4B,cAA5B,CAA4CJ,YAA5C,EACAP,MAAM,CAACC,YAAP,CAAoBU,OAApB,CAA4B,eAA5B,CAA6CZ,aAA7C,EACAC,MAAM,CAACC,YAAP,CAAoBU,OAApB,CAA4B,iBAA5B,CAA+CC,IAAI,CAACC,GAAL,EAA/C,EAEA,MAAON,CAAAA,YAAP,CACD,CACD;AACA,GAAMc,CAAAA,WAAW,CAAGrB,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,iBAA5B,CAApB,CAEA,GACEmB,WAAW,EACXA,WAAW,GAAK,WADhB,EAEAT,IAAI,CAACC,GAAL,GAAaQ,WAAb,CAA2B1B,eAH7B,CAIE,CACAc,OAAO,CAACC,GAAR,CAAY,iCAAZ,EACAZ,kBAAkB,GACnB,CAED,GAAMwB,CAAAA,kBAAkB,CAAGtB,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,cAA5B,CAA3B,CAEA,MAAOoB,CAAAA,kBAAP,CACD,CAlCM,CAoCP;AACA,MAAO,IAAMC,CAAAA,KAAK,CAAGL,cAAc,EAA5B,CAEPrB,UAAU,CAAC2B,cAAX,CAA0BD,KAA1B","sourcesContent":["import axios from \"axios\";\nimport { getHashParams, getObject, setObject } from \"./functions\";\nimport SpotifyWebApi from \"spotify-web-api-js\";\n\nconst EXPIRATION_TIME = 3600000; // 1 hour\nconst SERVER = \"https://react-express-spotify.herokuapp.com/\"; // or https://react-express-spotify.herokuapp.com http://localhost:8888\n//REFRESH ACCESS TOKEN EVERY 1 HOUR\n// REFRESH_URI\n\n// USES JMPerez's spotify-web-api-js\n\nexport const spotifyApi = new SpotifyWebApi();\n\n// constantly refreshing\nexport const refreshAccessToken = async () => {\n  // take refresh token from local storage\n  const refresh_token = window.localStorage.getItem(\"refresh_token\");\n  axios\n    .get(SERVER + \"refresh_token\", {\n      params: {\n        refresh_token: refresh_token,\n      },\n    })\n    .then((res) => {\n      const access_token = res.data.access_token;\n      console.log(\"New acccess_token\", access_token);\n      window.localStorage.setItem(\"access_token\", access_token);\n      window.localStorage.setItem(\"token_timestamp\", Date.now());\n      window.location.reload();\n    })\n    .catch((e) => console.log(e));\n};\n\n// GET TOKEN, REFRESH IF REQUIRED\nexport const getAccessToken = () => {\n  // Takes token from our url\n\n  const { error, access_token, refresh_token } = getHashParams();\n\n  //  token invalid freom timeout\n  if (error) {\n    console.log(error);\n    refreshAccessToken();\n  }\n\n  if (access_token && refresh_token) {\n    window.location.replace(\"/\");\n    window.localStorage.setItem(\"access_token\", access_token);\n    window.localStorage.setItem(\"refresh_token\", refresh_token);\n    window.localStorage.setItem(\"token_timestamp\", Date.now());\n\n    return access_token;\n  }\n  // THIS WILL AUTO REFRESH OUR TOKEN BASED ON EXPIRY TIME\n  const tokenExpiry = window.localStorage.getItem(\"token_timestamp\");\n\n  if (\n    tokenExpiry &&\n    tokenExpiry !== \"undefined\" &&\n    Date.now() - tokenExpiry > EXPIRATION_TIME\n  ) {\n    console.log(\"Token expired, refreshing token\");\n    refreshAccessToken();\n  }\n\n  const local_access_token = window.localStorage.getItem(\"access_token\");\n\n  return local_access_token;\n};\n\n// SET OUR TOKEN with our spotify-web-api-js\nexport const token = getAccessToken();\n\nspotifyApi.setAccessToken(token);\n"]},"metadata":{},"sourceType":"module"}