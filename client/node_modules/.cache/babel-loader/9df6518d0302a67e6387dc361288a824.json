{"ast":null,"code":"import _regeneratorRuntime from\"/Users/macuser/project/spotify-api-project/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/macuser/project/spotify-api-project/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import axios from\"axios\";import{getHashParams,getObject,setObject}from\"./functions\";import SpotifyWebApi from\"spotify-web-api-js\";var EXPIRATION_TIME=3600000;// 1 hour\nvar SERVER=\"https://react-express-spotify.herokuapp.com/\";// or https://react-express-spotify.herokuapp.com http://localhost:8888\n//REFRESH ACCESS TOKEN EVERY 1 HOUR\n// REFRESH_URI\n// USES JMPerez's spotify-web-api-js\nexport var spotifyApi=new SpotifyWebApi();// constantly refreshing\nexport var refreshAccessToken=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var refresh_token;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// take refresh token from local storage\nrefresh_token=window.localStorage.getItem(\"refresh_token\");axios.get(SERVER+\"refresh_token\",{params:{refresh_token:refresh_token}}).then(function(res){var access_token=res.data.access_token;console.log(\"New acccess_token\",access_token);window.localStorage.setItem(\"access_token\",access_token);window.localStorage.setItem(\"token_timestamp\",Date.now());window.location.reload();}).catch(function(e){return console.log(e);});case 2:case\"end\":return _context.stop();}}},_callee);}));return function refreshAccessToken(){return _ref.apply(this,arguments);};}();// GET TOKEN, REFRESH IF REQUIRED\nexport var getAccessToken=function getAccessToken(){// Takes token from our url\nvar _getHashParams=getHashParams(),error=_getHashParams.error,access_token=_getHashParams.access_token,refresh_token=_getHashParams.refresh_token;//  token invalid freom timeout\nif(error){console.log(error);refreshAccessToken();}if(access_token&&refresh_token){window.location.replace(\"/\");window.localStorage.setItem(\"access_token\",access_token);window.localStorage.setItem(\"refresh_token\",refresh_token);window.localStorage.setItem(\"token_timestamp\",Date.now());return access_token;}// THIS WILL AUTO REFRESH OUR TOKEN BASED ON EXPIRY TIME\nvar tokenExpiry=window.localStorage.getItem(\"token_timestamp\");if(tokenExpiry&&tokenExpiry!==\"undefined\"&&Date.now()-tokenExpiry>EXPIRATION_TIME){console.log(\"Token expired, refreshing token\");refreshAccessToken();}var local_access_token=window.localStorage.getItem(\"access_token\");return local_access_token;};// SET OUR TOKEN with our spotify-web-api-js\nexport var token=getAccessToken();spotifyApi.setAccessToken(token);","map":{"version":3,"sources":["/Users/macuser/project/spotify-api-project/client/src/components/spotifyAPI.js"],"names":["axios","getHashParams","getObject","setObject","SpotifyWebApi","EXPIRATION_TIME","SERVER","spotifyApi","refreshAccessToken","refresh_token","window","localStorage","getItem","get","params","then","res","access_token","data","console","log","setItem","Date","now","location","reload","catch","e","getAccessToken","error","replace","tokenExpiry","local_access_token","token","setAccessToken"],"mappings":"qQAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,aAAT,CAAwBC,SAAxB,CAAmCC,SAAnC,KAAoD,aAApD,CACA,MAAOC,CAAAA,aAAP,KAA0B,oBAA1B,CAEA,GAAMC,CAAAA,eAAe,CAAG,OAAxB,CAAiC;AACjC,GAAMC,CAAAA,MAAM,CAAG,8CAAf,CAA+D;AAC/D;AACA;AAEA;AAEA,MAAO,IAAMC,CAAAA,UAAU,CAAG,GAAIH,CAAAA,aAAJ,EAAnB,CAEP;AACA,MAAO,IAAMI,CAAAA,kBAAkB,0FAAG,qJAClC;AACOC,aAF2B,CAEXC,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,eAA5B,CAFW,CAGjCZ,KAAK,CACHa,GADF,CACMP,MAAM,CAAG,eADf,CACgC,CAC/BQ,MAAM,CAAE,CACPL,aAAa,CAAEA,aADR,CADuB,CADhC,EAMEM,IANF,CAMO,SAACC,GAAD,CAAS,CACf,GAAMC,CAAAA,YAAY,CAAGD,GAAG,CAACE,IAAJ,CAASD,YAA9B,CACAE,OAAO,CAACC,GAAR,CAAY,mBAAZ,CAAiCH,YAAjC,EACAP,MAAM,CAACC,YAAP,CAAoBU,OAApB,CAA4B,cAA5B,CAA4CJ,YAA5C,EACAP,MAAM,CAACC,YAAP,CAAoBU,OAApB,CAA4B,iBAA5B,CAA+CC,IAAI,CAACC,GAAL,EAA/C,EACAb,MAAM,CAACc,QAAP,CAAgBC,MAAhB,GACC,CAZF,EAaEC,KAbF,CAaQ,SAACC,CAAD,QAAOR,CAAAA,OAAO,CAACC,GAAR,CAAYO,CAAZ,CAAP,EAbR,EAHiC,sDAAH,kBAAlBnB,CAAAA,kBAAkB,0CAAxB,CAmBP;AACA,MAAO,IAAMoB,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAM,CACpC;AAEC,mBAA+C3B,aAAa,EAA5D,CAAQ4B,KAAR,gBAAQA,KAAR,CAAeZ,YAAf,gBAAeA,YAAf,CAA6BR,aAA7B,gBAA6BA,aAA7B,CAEA;AACA,GAAIoB,KAAJ,CAAW,CACVV,OAAO,CAACC,GAAR,CAAYS,KAAZ,EACArB,kBAAkB,GAClB,CAED,GAAIS,YAAY,EAAIR,aAApB,CAAmC,CAClCC,MAAM,CAACc,QAAP,CAAgBM,OAAhB,CAAwB,GAAxB,EACApB,MAAM,CAACC,YAAP,CAAoBU,OAApB,CAA4B,cAA5B,CAA4CJ,YAA5C,EACAP,MAAM,CAACC,YAAP,CAAoBU,OAApB,CAA4B,eAA5B,CAA6CZ,aAA7C,EACAC,MAAM,CAACC,YAAP,CAAoBU,OAApB,CAA4B,iBAA5B,CAA+CC,IAAI,CAACC,GAAL,EAA/C,EAEA,MAAON,CAAAA,YAAP,CACA,CACD;AACA,GAAMc,CAAAA,WAAW,CAAGrB,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,iBAA5B,CAApB,CAEA,GACCmB,WAAW,EACXA,WAAW,GAAK,WADhB,EAEAT,IAAI,CAACC,GAAL,GAAaQ,WAAb,CAA2B1B,eAH5B,CAIE,CACDc,OAAO,CAACC,GAAR,CAAY,iCAAZ,EACAZ,kBAAkB,GAClB,CAED,GAAMwB,CAAAA,kBAAkB,CAAGtB,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,cAA5B,CAA3B,CAEA,MAAOoB,CAAAA,kBAAP,CACA,CAlCM,CAoCP;AACA,MAAO,IAAMC,CAAAA,KAAK,CAAGL,cAAc,EAA5B,CAEPrB,UAAU,CAAC2B,cAAX,CAA0BD,KAA1B","sourcesContent":["import axios from \"axios\";\nimport { getHashParams, getObject, setObject } from \"./functions\";\nimport SpotifyWebApi from \"spotify-web-api-js\";\n\nconst EXPIRATION_TIME = 3600000; // 1 hour\nconst SERVER = \"https://react-express-spotify.herokuapp.com/\"; // or https://react-express-spotify.herokuapp.com http://localhost:8888\n//REFRESH ACCESS TOKEN EVERY 1 HOUR\n// REFRESH_URI\n\n// USES JMPerez's spotify-web-api-js\n\nexport const spotifyApi = new SpotifyWebApi();\n\n// constantly refreshing\nexport const refreshAccessToken = async () => {\n// take refresh token from local storage\n\tconst refresh_token = window.localStorage.getItem(\"refresh_token\");\n\taxios\n\t\t.get(SERVER + \"refresh_token\", {\n\t\tparams: {\n\t\t\trefresh_token: refresh_token,\n\t\t},\n\t\t})\n\t\t.then((res) => {\n\t\tconst access_token = res.data.access_token;\n\t\tconsole.log(\"New acccess_token\", access_token);\n\t\twindow.localStorage.setItem(\"access_token\", access_token);\n\t\twindow.localStorage.setItem(\"token_timestamp\", Date.now());\n\t\twindow.location.reload();\n\t\t})\n\t\t.catch((e) => console.log(e));\n};\n\n// GET TOKEN, REFRESH IF REQUIRED\nexport const getAccessToken = () => {\n// Takes token from our url\n\n\tconst { error, access_token, refresh_token } = getHashParams();\n\n\t//  token invalid freom timeout\n\tif (error) {\n\t\tconsole.log(error);\n\t\trefreshAccessToken();\n\t}\n\n\tif (access_token && refresh_token) {\n\t\twindow.location.replace(\"/\");\n\t\twindow.localStorage.setItem(\"access_token\", access_token);\n\t\twindow.localStorage.setItem(\"refresh_token\", refresh_token);\n\t\twindow.localStorage.setItem(\"token_timestamp\", Date.now());\n\n\t\treturn access_token;\n\t}\n\t// THIS WILL AUTO REFRESH OUR TOKEN BASED ON EXPIRY TIME\n\tconst tokenExpiry = window.localStorage.getItem(\"token_timestamp\");\n\n\tif (\n\t\ttokenExpiry &&\n\t\ttokenExpiry !== \"undefined\" &&\n\t\tDate.now() - tokenExpiry > EXPIRATION_TIME\n\t) {\n\t\tconsole.log(\"Token expired, refreshing token\");\n\t\trefreshAccessToken();\n\t}\n\n\tconst local_access_token = window.localStorage.getItem(\"access_token\");\n\n\treturn local_access_token;\n};\n\n// SET OUR TOKEN with our spotify-web-api-js\nexport const token = getAccessToken();\n\nspotifyApi.setAccessToken(token);\n"]},"metadata":{},"sourceType":"module"}