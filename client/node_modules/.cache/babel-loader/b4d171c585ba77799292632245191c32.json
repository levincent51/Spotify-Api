{"ast":null,"code":"import axios from 'axios';\nimport { getHashParams, getObject, setObject } from './functions';\nimport SpotifyWebApi from 'spotify-web-api-js';\nconst EXPIRATION_TIME = 3600000; // 1 hour\n\nconst SERVER = 'http://localhost:8888/'; //REFRESH ACCESS TOKEN EVERY 1 HOUR\n// REFRESH_URI\n\nconst spotifyApi = new SpotifyWebApi(); // constantly refreshing\n\nexport const refreshAccessToken = async () => {\n  // take refresh token from local storage\n  const refresh_token = window.localStorage.getItem('refresh_token');\n  axios.get(SERVER + 'refresh_token', {\n    params: {\n      refresh_token: refresh_token\n    }\n  }).then(res => {\n    const access_token = res.data.access_token;\n    console.log('New acccess_token', access_token);\n    window.localStorage.setItem('access_token', access_token);\n    window.localStorage.setItem('token_timestamp', Date.now());\n    window.location.reload();\n  }).catch(e => console.log(e));\n}; // GET TOKEN, REFRESH IF REQUIRED\n\nexport const getAccessToken = () => {\n  // Takes token from our url\n  const {\n    error,\n    access_token,\n    refresh_token\n  } = getHashParams(); //  token invalid freom timeout \n\n  if (error) {\n    console.log(error);\n    refreshAccessToken();\n  }\n\n  if (access_token && refresh_token) {\n    window.localStorage.setItem('access_token', access_token);\n    window.localStorage.setItem('refresh_token', refresh_token);\n    window.localStorage.setItem('token_timestamp', Date.now());\n    window.location.replace('/');\n    spotifyApi.setAccessToken(access_token);\n    return access_token;\n  } // THIS WILL AUTO REFRESH OUR TOKEN BASED ON EXPIRY TIME \n\n\n  const tokenExpiry = window.localStorage.getItem('token_timestamp');\n\n  if (tokenExpiry && tokenExpiry !== 'undefined' && Date.now() - tokenExpiry > EXPIRATION_TIME) {\n    console.log('Token expired, refreshing token');\n    refreshAccessToken();\n  }\n\n  const local_access_token = window.localStorage.getItem('access_token');\n  spotifyApi.setAccessToken(local_access_token);\n  return local_access_token;\n};\nexport const token = getAccessToken();","map":{"version":3,"sources":["/Users/macuser/project/spotify-node-react-starter-kit/client/src/components/spotifyAPI.js"],"names":["axios","getHashParams","getObject","setObject","SpotifyWebApi","EXPIRATION_TIME","SERVER","spotifyApi","refreshAccessToken","refresh_token","window","localStorage","getItem","get","params","then","res","access_token","data","console","log","setItem","Date","now","location","reload","catch","e","getAccessToken","error","replace","setAccessToken","tokenExpiry","local_access_token","token"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,aAAT,EAAwBC,SAAxB,EAAmCC,SAAnC,QAAoD,aAApD;AACA,OAAOC,aAAP,MAA0B,oBAA1B;AAEA,MAAMC,eAAe,GAAG,OAAxB,C,CAAiC;;AACjC,MAAMC,MAAM,GAAG,wBAAf,C,CACA;AACA;;AAIA,MAAMC,UAAU,GAAG,IAAIH,aAAJ,EAAnB,C,CAEA;;AACA,OAAO,MAAMI,kBAAkB,GAAG,YAAY;AAC1C;AACA,QAAMC,aAAa,GAAGC,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,eAA5B,CAAtB;AACAZ,EAAAA,KAAK,CAACa,GAAN,CAAUP,MAAM,GAAG,eAAnB,EAAoC;AAChCQ,IAAAA,MAAM,EAAE;AACNL,MAAAA,aAAa,EAAEA;AADT;AADwB,GAApC,EAKGM,IALH,CAKSC,GAAD,IAAS;AACb,UAAMC,YAAY,GAAGD,GAAG,CAACE,IAAJ,CAASD,YAA9B;AACAE,IAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAiCH,YAAjC;AACAP,IAAAA,MAAM,CAACC,YAAP,CAAoBU,OAApB,CAA4B,cAA5B,EAA4CJ,YAA5C;AACAP,IAAAA,MAAM,CAACC,YAAP,CAAoBU,OAApB,CAA4B,iBAA5B,EAA+CC,IAAI,CAACC,GAAL,EAA/C;AACAb,IAAAA,MAAM,CAACc,QAAP,CAAgBC,MAAhB;AACD,GAXH,EAYGC,KAZH,CAYUC,CAAD,IAAOR,OAAO,CAACC,GAAR,CAAYO,CAAZ,CAZhB;AAaH,CAhBM,C,CAkBP;;AACA,OAAO,MAAMC,cAAc,GAAG,MAAM;AAChC;AAEA,QAAM;AAAEC,IAAAA,KAAF;AAASZ,IAAAA,YAAT;AAAuBR,IAAAA;AAAvB,MAAyCR,aAAa,EAA5D,CAHgC,CAIhC;;AACA,MAAI4B,KAAJ,EAAW;AACTV,IAAAA,OAAO,CAACC,GAAR,CAAYS,KAAZ;AACArB,IAAAA,kBAAkB;AACnB;;AAED,MAAIS,YAAY,IAAIR,aAApB,EAAmC;AACjCC,IAAAA,MAAM,CAACC,YAAP,CAAoBU,OAApB,CAA4B,cAA5B,EAA4CJ,YAA5C;AACAP,IAAAA,MAAM,CAACC,YAAP,CAAoBU,OAApB,CAA4B,eAA5B,EAA6CZ,aAA7C;AACAC,IAAAA,MAAM,CAACC,YAAP,CAAoBU,OAApB,CAA4B,iBAA5B,EAA+CC,IAAI,CAACC,GAAL,EAA/C;AACAb,IAAAA,MAAM,CAACc,QAAP,CAAgBM,OAAhB,CAAwB,GAAxB;AAEAvB,IAAAA,UAAU,CAACwB,cAAX,CAA0Bd,YAA1B;AACA,WAAOA,YAAP;AACD,GAlB+B,CAmBhC;;;AACA,QAAMe,WAAW,GAAGtB,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,iBAA5B,CAApB;;AAEA,MACEoB,WAAW,IACXA,WAAW,KAAK,WADhB,IAEAV,IAAI,CAACC,GAAL,KAAaS,WAAb,GAA2B3B,eAH7B,EAIE;AACAc,IAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ;AACAZ,IAAAA,kBAAkB;AACnB;;AAED,QAAMyB,kBAAkB,GAAGvB,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,cAA5B,CAA3B;AAEAL,EAAAA,UAAU,CAACwB,cAAX,CAA0BE,kBAA1B;AACA,SAAOA,kBAAP;AACH,CAnCM;AAqCP,OAAO,MAAMC,KAAK,GAAGN,cAAc,EAA5B","sourcesContent":["import axios from 'axios';\nimport { getHashParams, getObject, setObject } from './functions';\nimport SpotifyWebApi from 'spotify-web-api-js';\n\nconst EXPIRATION_TIME = 3600000; // 1 hour\nconst SERVER = 'http://localhost:8888/'\n//REFRESH ACCESS TOKEN EVERY 1 HOUR\n// REFRESH_URI\n\n\n\nconst spotifyApi = new SpotifyWebApi();\n\n// constantly refreshing\nexport const refreshAccessToken = async () => {\n    // take refresh token from local storage\n    const refresh_token = window.localStorage.getItem('refresh_token');\n    axios.get(SERVER + 'refresh_token', {\n        params: {\n          refresh_token: refresh_token,\n        },\n      })\n      .then((res) => {\n        const access_token = res.data.access_token;\n        console.log('New acccess_token', access_token);\n        window.localStorage.setItem('access_token', access_token);\n        window.localStorage.setItem('token_timestamp', Date.now());\n        window.location.reload();\n      })\n      .catch((e) => console.log(e));\n};\n\n// GET TOKEN, REFRESH IF REQUIRED\nexport const getAccessToken = () => {\n    // Takes token from our url\n\n    const { error, access_token, refresh_token } = getHashParams();\n    //  token invalid freom timeout \n    if (error) {\n      console.log(error);\n      refreshAccessToken();\n    }\n  \n    if (access_token && refresh_token) {\n      window.localStorage.setItem('access_token', access_token);\n      window.localStorage.setItem('refresh_token', refresh_token);\n      window.localStorage.setItem('token_timestamp', Date.now());\n      window.location.replace('/')\n\n      spotifyApi.setAccessToken(access_token)\n      return access_token;\n    }\n    // THIS WILL AUTO REFRESH OUR TOKEN BASED ON EXPIRY TIME \n    const tokenExpiry = window.localStorage.getItem('token_timestamp');\n\n    if (\n      tokenExpiry &&\n      tokenExpiry !== 'undefined' &&\n      Date.now() - tokenExpiry > EXPIRATION_TIME\n    ) {\n      console.log('Token expired, refreshing token')\n      refreshAccessToken();\n    }\n  \n    const local_access_token = window.localStorage.getItem('access_token');\n  \n    spotifyApi.setAccessToken(local_access_token)\n    return local_access_token;\n};\n\nexport const token = getAccessToken();\n\n"]},"metadata":{},"sourceType":"module"}